(function(){"use strict";var e=typeof window!="undefined"?window:global;if(typeof e.require=="function")return;var t={},n={},r=function(e,t){return{}.hasOwnProperty.call(e,t)},i=function(e,t){var n=[],r,i;/^\.\.?(\/|$)/.test(t)?r=[e,t].join("/").split("/"):r=t.split("/");for(var s=0,o=r.length;s<o;s++)i=r[s],i===".."?n.pop():i!=="."&&i!==""&&n.push(i);return n.join("/")},s=function(e){return e.split("/").slice(0,-1).join("/")},o=function(t){return function(n){var r=s(t),o=i(r,n);return e.require(o,t)}},u=function(e,t){var r={id:e,exports:{}};return n[e]=r,t(r.exports,o(e),r),r.exports},a=function(e,s){var o=i(e,".");s==null&&(s="/");if(r(n,o))return n[o].exports;if(r(t,o))return u(o,t[o]);var a=i(o,"./index");if(r(n,a))return n[a].exports;if(r(t,a))return u(a,t[a]);throw new Error('Cannot find module "'+e+'" from '+'"'+s+'"')},f=function(e,n){if(typeof e=="object")for(var i in e)r(e,i)&&(t[i]=e[i]);else t[e]=n},l=function(){var e=[];for(var n in t)r(t,n)&&e.push(n);return e};e.require=a,e.require.define=f,e.require.register=f,e.require.list=l,e.require.brunch=!0})(),require.register("collections/notes",function(e,t,n){var r,i,s,o,u,a={}.hasOwnProperty,f=function(e,t){function r(){this.constructor=e}for(var n in t)a.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r=t("models/note").Note,u=t("../lib/request"),s=function(e,t){return(e!=null?e.length:void 0)>t?e.substring(1,t-1)+"...":e},o=function(e){var t,n;return n=s(e.content,200),t=new Showdown.converter,n=t.makeHtml(n),n},i=function(e){function t(){t.__super__.constructor.call(this)}return f(t,e),t.prototype.model=r,t.prototype.url="notes/",t.prototype.parse=function(e){return e.rows||e},t.search=function(e,t){var n=this;return e.length>0?u.post("notes/search",{query:e},function(e,n){var i,s,o,u;if(e)return alert("Server error occured while searching.");s=[];for(o=0,u=n.length;o<u;o++)i=n[o],s.push(new r(i));return t(s)}):t([])},t}(Backbone.Collection),n.exports=i}),require.register("helpers",function(e,t,n){e.BrunchApplication=function(){function e(){var e=this;$(function(){return e.initialize(e),Backbone.history.start()})}return e.prototype.initializeJQueryExtensions=function(){return $.fn.spin=function(e,t){var n;n={tiny:{lines:8,length:2,width:1,radius:3},small:{lines:8,length:2,width:1,radius:5},large:{lines:7,length:1,width:2,radius:5}};if(Spinner)return this.each(function(){var r,i,s;r=$(this),s=r.data("spinner");if(s!=null)return s.stop(),r.data("spinner",null);if(e!==!1)return typeof e=="string"&&(e in n?e=n[e]:e={},t&&(e.color=t)),i={color:r.css("color")},s=new Spinner($.extend(i,e)),s.spin(this),r.data("spinner",s)});throw"Spinner class not available."}},e.prototype.initialize=function(){return null},e}(),e.slugify=function(e){var t,n;return n=/[^\w\s-]/g,t=/[-\s]+/g,e=e.replace(n,"").trim().toLowerCase(),e=e.replace(t,"-"),e},e.getPathRegExp=function(e){var t;return t=new RegExp("/","g"),"^"+e.replace(t,"/")}}),require.register("initialize",function(e,t,n){var r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r=t("helpers").BrunchApplication,s=t("routers/main_router").MainRouter,i=t("views/home_view").HomeView,e.Application=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return u(t,e),t.prototype.initialize=function(){return this.initializeJQueryExtensions(),this.homeView=new i,this.homeView.render(),this.router=new s},t}(r),window.app=new e.Application}),require.register("lib/request",function(e,t,n){e.request=function(e,t,n,r){return $.ajax({type:e,url:t,data:n!=null?JSON.stringify(n):null,contentType:n!=null?"application/json":null,success:function(e){if(r!=null)return r(null,e)},error:function(){if(n.msg!=null&&r!=null)return r(new Error(n.msg));if(r!=null)return r(new Error("Server error occured"))}})},e.get=function(t,n){return e.request("GET",t,null,n)},e.post=function(t,n,r){return e.request("POST",t,n,r)},e.put=function(t,n,r){return e.request("PUT",t,n,r)},e.del=function(t,n){return e.request("DELETE",t,null,n)}}),require.register("lib/slug",function(e,t,n){var r,i,s,o;i=["sign","cross","of","symbol","staff"],i=function(){var e,t,n;n=[];for(e=0,t=i.length;e<t;e++)o=i[e],n.push(new RegExp(o,"gi"));return n}(),r={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","Æ":"AE","Ç":"C","È":"E","É":"E","Ê":"E","Ë":"E","Ì":"I","Í":"I","Î":"I","Ï":"I","Ð":"D","Ñ":"N","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ő":"O","Ø":"O","Ù":"U","Ú":"U","Û":"U","Ü":"U","Ű":"U","Ý":"Y","Þ":"TH","ß":"ss","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","æ":"ae","ç":"c","è":"e","é":"e","ê":"e","ë":"e","ì":"i","í":"i","î":"i","ï":"i","ð":"d","ñ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ő":"o","ø":"o","ù":"u","ú":"u","û":"u","ü":"u","ű":"u","ý":"y","þ":"th","ÿ":"y","ẞ":"SS","α":"a","β":"b","γ":"g","δ":"d","ε":"e","ζ":"z","η":"h","θ":"8","ι":"i","κ":"k","λ":"l","μ":"m","ν":"n","ξ":"3","ο":"o","π":"p","ρ":"r","σ":"s","τ":"t","υ":"y","φ":"f","χ":"x","ψ":"ps","ω":"w","ά":"a","έ":"e","ί":"i","ό":"o","ύ":"y","ή":"h","ώ":"w","ς":"s","ϊ":"i","ΰ":"y","ϋ":"y","ΐ":"i","Α":"A","Β":"B","Γ":"G","Δ":"D","Ε":"E","Ζ":"Z","Η":"H","Θ":"8","Ι":"I","Κ":"K","Λ":"L","Μ":"M","Ν":"N","Ξ":"3","Ο":"O","Π":"P","Ρ":"R","Σ":"S","Τ":"T","Υ":"Y","Φ":"F","Χ":"X","Ψ":"PS","Ω":"W","Ά":"A","Έ":"E","Ί":"I","Ό":"O","Ύ":"Y","Ή":"H","Ώ":"W","Ϊ":"I","Ϋ":"Y","ş":"s","Ş":"S","ı":"i","İ":"I","ğ":"g","Ğ":"G","а":"a","б":"b","в":"v","г":"g","д":"d","е":"e","ё":"yo","ж":"zh","з":"z","и":"i","й":"j","к":"k","л":"l","м":"m","н":"n","о":"o","п":"p","р":"r","с":"s","т":"t","у":"u","ф":"f","х":"h","ц":"c","ч":"ch","ш":"sh","щ":"sh","ъ":"u","ы":"y","ь":"","э":"e","ю":"yu","я":"ya","А":"A","Б":"B","В":"V","Г":"G","Д":"D","Е":"E","Ё":"Yo","Ж":"Zh","З":"Z","И":"I","Й":"J","К":"K","Л":"L","М":"M","Н":"N","О":"O","П":"P","Р":"R","С":"S","Т":"T","У":"U","Ф":"F","Х":"H","Ц":"C","Ч":"Ch","Ш":"Sh","Щ":"Sh","Ъ":"U","Ы":"Y","Ь":"","Э":"E","Ю":"Yu","Я":"Ya","Є":"Ye","І":"I","Ї":"Yi","Ґ":"G","є":"ye","і":"i","ї":"yi","ґ":"g","č":"c","ď":"d","ě":"e","ň":"n","ř":"r","š":"s","ť":"t","ů":"u","ž":"z","Č":"C","Ď":"D","Ě":"E","Ň":"N","Ř":"R","Š":"S","Ť":"T","Ů":"U","Ž":"Z","ą":"a","ć":"c","ę":"e","ł":"l","ń":"n","ś":"s","ź":"z","ż":"z","Ą":"A","Ć":"C","Ę":"e","Ł":"L","Ń":"N","Ś":"S","Ź":"Z","Ż":"Z","ā":"a","ē":"e","ģ":"g","ī":"i","ķ":"k","ļ":"l","ņ":"n","ū":"u","Ā":"A","Ē":"E","Ģ":"G","Ī":"i","Ķ":"k","Ļ":"L","Ņ":"N","Ū":"u","€":"euro","₢":"cruzeiro","₣":"french franc","£":"pound","₤":"lira","₥":"mill","₦":"naira","₧":"peseta","₨":"rupee","₩":"won","₪":"new shequel","₫":"dong","₭":"kip","₮":"tugrik","₯":"drachma","₰":"penny","₱":"peso","₲":"guarani","₳":"austral","₴":"hryvnia","₵":"cedi","¢":"cent","¥":"yen","元":"yuan","円":"yen","﷼":"rial","₠":"ecu","¤":"currency","฿":"baht",$:"dollar","©":"(c)","œ":"oe","Œ":"OE","∑":"sum","®":"(r)","†":"+","“":'"',"”":'"',"‘":"'","’":"'","∂":"d","ƒ":"f","™":"tm","℠":"sm","…":"...","˚":"o","º":"o","ª":"a","•":"*","∆":"delta","∞":"infinity","♥":"love","&":"and","|":"or","<":"less",">":"greater"},n.exports=s=function(e,t){var n,i,s,o,u,a;t==null&&(t="-"),o="";for(s=u=0,a=e.length;u<a;s=++u)n=e[s],i=e.charCodeAt(s),r[n]&&(n=r[n],i=n.charCodeAt(0)),n=n.replace(/[^\w\s$\*\_\+~\.\(\)\'\"\!\-:@]/g,""),o+=n;return o=o.replace(/^\s+|\s+$/g,""),o=o.replace(/[-\s]+/g,t),o.replace(""+t+"$",""),o.toLowerCase()}}),require.register("models/models",function(e,t,n){var r={}.hasOwnProperty,i=function(e,t){function i(){this.constructor=e}for(var n in t)r.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};e.BaseModel=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return i(t,e),t.prototype.isNew=function(){return this.id==null},t}(Backbone.Model)}),require.register("models/note",function(e,t,n){var r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r=t("models/models").BaseModel,i=t("lib/request"),s=t("lib/slug"),e.Note=function(e){function t(e){var n,r,i,o,u,a;t.__super__.constructor.call(this);for(r in e)this[r]=e[r];typeof this.path=="string"&&(this.path=JSON.parse(this.path)),i=[];if(this.path!=null){a=this.path;for(o=0,u=a.length;o<u;o++)n=a[o],i.push(s(n))}this.slugPath="all/"+i.join("/")}return u(t,e),t.prototype.rootUrl="notes/",t.prototype.saveContent=function(e){return this.content=e,this.url="notes/"+this.id,this.save({content:this.content})},t.createNote=function(e,t){return e.version="1",i.post("notes",e,t)},t.updateNote=function(e,t,n){return t.version="1",i.put("notes/"+e,t,n)},t.deleteNote=function(e,t){return i.del("notes/"+e,t)},t.getNote=function(e,n){var r=this;return $.get("notes/"+e,function(e){var r;return r=new t(e),n(r)})},t}(r)}),require.register("routers/main_router",function(e,t,n){var r,i={}.hasOwnProperty,s=function(e,t){function r(){this.constructor=e}for(var n in t)i.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r=t("helpers").slugify,e.MainRouter=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return s(t,e),t.prototype.routes={"":"home","note/all":"allNotes","search/:query":"search"},t.prototype.initialize=function(){return this.route(/^note\/(.*?)\/(.*?)$/,"note")},t.prototype.home=function(){return this.navigate("note/all",{trigger:!1}),this._initializeTree("tree-node-all",function(){return app.homeView.selectNoteIfIframeLoaded()})},t.prototype.allNotes=function(){return $("#tree").length>0?app.homeView.selectNote("tree-node-all"):this._initializeTree("tree-node-all",function(){return app.homeView.selectNoteIfIframeLoaded()})},t.prototype.note=function(e,t){return $("#tree").length>0?app.homeView.selectNote(e):this._initializeTree(e,function(){return app.homeView.selectNoteIfIframeLoaded()})},t.prototype.search=function(e){return e=e.replace(/-/g," "),$("#tree").length===0?this._initializeTree("",function(){return app.homeView.tree.addSearchTag(e),app.homeView.search(e)}):app.homeView.search(e)},t.prototype._initializeTree=function(e,t){return $("body").append(app.homeView.el),app.homeView.initContent(e,t)},t}(Backbone.Router)}),require.register("views/home_view",function(e,t,n){var r,i,s,o,u,a,f,l=function(e,t){return function(){return e.apply(t,arguments)}},c={}.hasOwnProperty,h=function(e,t){function r(){this.constructor=e}for(var n in t)c.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};a=t("./widgets/tree").Tree,s=t("./note_view").NoteView,r=t("./latest_view").LatestView,i=t("../models/note").Note,o=t("../collections/notes"),u=t("./search_view"),f=t("../lib/slug"),e.HomeView=function(e){function n(){return this.renderNote=l(this.renderNote,this),this.selectNote=l(this.selectNote,this),this.onTreeSelectionChg=l(this.onTreeSelectionChg,this),this.onTreeRemove=l(this.onTreeRemove,this),this.enableTreeHotkey=l(this.enableTreeHotkey,this),this.disableTreeHotkey=l(this.disableTreeHotkey,this),this.onNoteTitleChange=l(this.onNoteTitleChange,this),this.onTreeRename=l(this.onTreeRename,this),this.search=l(this.search,this),this.onSearch=l(this.onSearch,this),this.onWindowScrolled=l(this.onWindowScrolled,this),this.onWindowResized=l(this.onWindowResized,this),this.onWindowClosed=l(this.onWindowClosed,this),this.selectNoteIfIframeLoaded=l(this.selectNoteIfIframeLoaded,this),this.onIFrameLoaded=l(this.onIFrameLoaded,this),n.__super__.constructor.apply(this,arguments)}return h(n,e),n.prototype.id="home-view",n.prototype.initContent=function(e,t){return this.note_uuid=e,this.iframeLoaded=!1,this.treeLoaded=!1,this.buildViews(),this.configureLayoutDrag(),this.loadTree(t),this.configureScrolling(),this.configureResize(),this.configureSaving()},n.prototype.buildViews=function(){var e=this;return this.$el.html(t("./templates/home")),this.noteView=new s(this,this.onIFrameLoaded),this.noteFull=this.$("#note-full"),this.noteFull.hide(),this.latestView=new r,this.latestView.$el.appendTo($("#note-area")),this.searchView=new u(this.$("#search-view")),this.$el.layout({size:"250",minSize:"250",resizable:!0,spacing_open:10,spacing_closed:10,togglerLength_closed:"100%",defaults:{enableCursorHotkey:!1},onresize_end:function(){return e.onWindowResized()}})},n.prototype.loadTree=function(e){var t=this;return $.get("tree/",function(n){return window.tree=n,t.tree=new a(t.$("#nav"),n,{onCreate:t.onCreateFolder,onRename:t.onTreeRename,onRemove:t.onTreeRemove,onSelect:t.onTreeSelectionChg,onLoaded:e,onDrop:t.onNoteDropped,onSearch:t.onSearch}),t.$("#create-note").click(function(){return t.tree.widget.jstree("create","#tree-node-all","first","A New Note")})})},n.prototype.configureLayoutDrag=function(){var e;return e=$("#drag"),$(".ui-layout-resizer").bind("mousedown",function(e){})},n.prototype.configureResize=function(){return this.onWindowResized(),$(window).resize(this.onWindowResized),this.faketop.on("topaffix",this.onWindowResized)},n.prototype.configureScrolling=function(){return this.faketop=$('            <div id="faketop">                <div id="faketop-grad"></div>            </div>'),this.faketop.prependTo($("#note-full")),$("#note-area").scroll(this.onWindowScrolled)},n.prototype.configureSaving=function(){return window.addEventListener("beforeunload",this.onWindowClosed)},n.prototype.onIFrameLoaded=function(){return this.iframeLoaded=!0,this.treeLoaded&&this.selectNote(this.note_uuid),this.treeLoaded=!0,this.iframe=$("iframe")},n.prototype.selectNoteIfIframeLoaded=function(){this.treeLoaded=!0;if(this.iframeLoaded)return this.selectNote(this.note_uuid)},n.prototype.onWindowClosed=function(e){var t;return this.noteView!=null&&this.noteView.savingState==="clean"?null:(t="You have some unsaved changes. ",t+="Please stay on this page while they are saved.",this.noteView!=null&&this.noteView.savingState==="dirty"&&this.noteView.saveEditorContent(),e.returnValue=t,t)},n.prototype.onWindowResized=function(){var e,t,n,r,i,s,o;o=$(window).width(),s=$(window).height(),n=$("#note-style"),r=n.offset().left,this.faketop!=null&&(this.faketop.width(n.width()),this.faketop.offset({left:r})),t=$("#note-file-list"),e=$("#editor-button-bar"),e.css({left:r-.5*e.width()}),i=$("#note-full-title"),i.width($("#editor-container").width()-10);if(this.faketop!=null)return this.faketop.width(n.width()+102),$("#faketop-grad").width(n.width()+102),this.faketop.offset({left:r})},n.prototype.onWindowScrolled=function(){var e;return e=$("#note-area").scrollTop(),this.handleAffix($("#note-full-breadcrumb"),e,30),this.handleAffix($("#note-file-list"),e,30),this.handleAffix($("#note-full-title"),e,30),this.handleAffix($("#faketop"),e,30),this.handleAffix($("#faketop-grad"),e,30)},n.prototype.handleAffix=function(e,t,n){if(t>n){if(!e.hasClass("topaffix"))return e.addClass("topaffix"),e.trigger("topaffix")}else if(e.hasClass("topaffix"))return e.removeClass("topaffix"),e.trigger("topaffix")},n.prototype.onSearch=function(e){if(e.length>0)return app.router.navigate("search/"+f(e),{trigger:!0});if(this.treeLoaded)return app.router.navigate("note/all",{trigger:!0})},n.prototype.search=function(e){var t=this;if(this.tree!=null)return this.latestView.$el.hide(),this.tree.widget.jstree("search",e),o.search(e,function(n){return t.searchView.fill(n,e),t.noteFull.fadeOut(function(){return t.searchView.fadeIn()})})},n.prototype.onCreateFolder=function(e,t,n){return i.createNote({title:t,parent_id:e},function(e,t){return e?alert("Server error occured."):(n.rslt.obj.data("id",t.id),n.rslt.obj.prop("id",t.id),n.inst.deselect_all(),n.inst.select_node(n.rslt.obj))})},n.prototype.onTreeRename=function(e,t){if(t!=null)return this.tree.currentNote_uuid===e&&(this.noteView.setTitle(t),this.noteView.updateBreadcrumbOnTitleChange(t)),i.updateNote(e,{title:t},function(e){if(e)return alert("Server error occured")})},n.prototype.onNoteTitleChange=function(e,t){var n=this;if(t!=null)return this.tree.jstreeEl.jstree("rename_node","#"+e,t),i.updateNote(e,{title:t},function(e){return e&&alert("Server error occured"),n.noteView.updateEditorReminderCf(t)})},n.prototype.disableTreeHotkey=function(){return this.tree.disable_hotkeys()},n.prototype.enableTreeHotkey=function(){return this.tree.enable_hotkeys()},n.prototype.onTreeRemove=function(e){return this.currentNote&&this.currentNote.id===e?this.currentNote.destroy():i.deleteNote(e,function(e){if(e)return alert("Server error occured")})},n.prototype.onTreeSelectionChg=function(e,t,n){var r,s,o=this;return this.tree.widget.jstree("search",""),this.searchView.hide(),r=function(){return e.indexOf("/")&&(e="/"+e),app.router.navigate("note"+e,{trigger:!1}),t==null||t==="tree-node-all"?(o.latestView.$el.show(),o.noteFull.hide()):(o.latestView.$el.hide(),o.noteView.showLoading(),i.getNote(t,function(e){return o.noteView.hideLoading(),o.renderNote(e,n),o.noteFull.show(),o.onWindowResized()}))},((s=this.noteView)!=null?s.savingState:void 0)==="clean"?r():this.noteView.saveEditorContent(function(e){return e?console.log(e):r()})},n.prototype.onNoteDropped=function(e,t){return i.updateNote(e,{parent_id:t},function(){})},n.prototype.selectNote=function(e){var t,n;return e==null||e==="all"||e==="tree-node-all"||e.length===0?(this.latestView.$el.show(),this.noteFull.hide(),(t=this.tree)!=null&&t.widget.jstree("deselect_all"),(n=this.tree)!=null&&n.widget.jstree("search",""),this.searchView.hide()):this.tree.selectNode(e)},n.prototype.renderNote=function(e,t){return e.url="notes/"+e.id,this.currentNote=e,this.noteView.setModel(e,t)},n}(Backbone.View)}),require.register("views/latest_view",function(e,t,n){var r,i=function(e,t){return function(){return e.apply(t,arguments)}},s={}.hasOwnProperty,o=function(e,t){function r(){this.constructor=e}for(var n in t)s.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r=t("collections/notes"),e.LatestView=function(e){function n(){return this.render=i(this.render,this),n.__super__.constructor.apply(this,arguments)}return o(n,e),n.prototype.id="latest-view",n.prototype.itemTemplate=t("views/templates/search_result"),n.prototype.initialize=function(){return this.collection=new r,this.refresh()},n.prototype.refresh=function(){return this.collection.reset([]),this.collection.fetch({url:"notes/latest/",success:this.render})},n.prototype.render=function(){var e=this;return this.$el.html(""),this.$el.append("<h1>Latest Notes</h1>"),this.collection.length===0?this.$el.append("<p>You have no notes, use the tree on the left tocreate one.</p>"):this.collection.each(function(t){var n;return n=Date.create(t.lastModificationValueOf),n=n.long(),e.$el.append(e.itemTemplate({note:t,date:n}))})},n}(Backbone.View)}),require.register("views/note_view",function(e,t,n){var r,i,s,o,u,a,f=function(e,t){return function(){return e.apply(t,arguments)}},l={}.hasOwnProperty,c=function(e,t){function r(){this.constructor=e}for(var n in t)l.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};a=t("./templates/note"),s=t("../models/note").Note,o=t("./widgets/tree"),i=t("./widgets/file_list").FileList,r=t("CNeditor/editor"),u=t("../helpers"),e.NoteView=function(e){function n(e,s){this.homeView=e,this.onIFrameLoaded=s,this.saveEditorContent=f(this.saveEditorContent,this),this.updateEditorReminderCf=f(this.updateEditorReminderCf,this),n.__super__.constructor.apply(this,arguments),this.$el=$("#note-full"),this.$("#editor").html(t("./templates/editor")),this.savingState="clean",this.saveTimer=null,this.saveButton=this.$("#save-editor-content"),this.noteFullTitle=this.$("#note-full-title"),this.breadcrumb=this.$("#note-full-breadcrumb"),this.editor=new r(this.$("#editor-container")[0],this.onIFrameLoaded),this.configureButtons(),this.setTitleListeners(),this.setEditorFocusListener(),this.setSaveListeners(),this.fileList=new i(this.model,"#file-list")}return c(n,e),n.prototype.className="note-full",n.prototype.id="note-full",n.prototype.tagName="div",n.prototype.remove=function(){return this.$el.remove()},n.prototype.setSaveListeners=function(){var e=this;return this.$("#editor-container").on("onChange",function(){return e.saveButton.removeClass("active"),clearTimeout(e.saveTimer),e.saveTimer=setTimeout(e.saveEditorContent,3e3),e.savingState="dirty"}),this.saveButton.click(this.saveEditorContent),this.$("#editor-container").on("saveRequest",function(){return e.savingState="dirty",e.saveEditorContent()})},n.prototype.setTitleListeners=function(){var e=this;return this.noteFullTitle.live("keypress",function(t){if(t.keyCode===13)return e.noteFullTitle.trigger("blur")}),this.noteFullTitle.blur(function(){var t,n;t=e.noteFullTitle.val(),n=e.model.title;if(t!==""&&n!==t)return e.homeView.onNoteTitleChange(e.model.id,t),e.homeView.tree._updateSuggestionList("rename",t,n),e.updateBreadcrumbOnTitleChange(t)})},n.prototype.setEditorFocusListener=function(){var e;return e=document.getElementById("editor-container"),e.addEventListener("focus",this.homeView.disableTreeHotkey,!0),e.addEventListener("blur",this.homeView.enableTreeHotkey,!0)},n.prototype.configureButtons=function(){var e,t=this;return this.indentBtn=this.$("#indentBtn"),this.unIndentBtn=this.$("#unIndentBtn"),this.markerListBtn=this.$("#markerListBtn"),this.toggleBtn=this.$("#toggleBtn"),this.boldBtn=this.$("#boldBtn"),this.linkBtn=this.$("#linkBtn"),this.metaBtn=this.$("#metaBtn"),this.saveEditorBtn=this.$("#save-editor-content"),this.titleBtn=this.$("#titleBtn"),e={show:400,hide:100},this.indentBtn.tooltip({placement:"right",title:"Indent (Tab)",delay:e}),this.indentBtn.on("click",function(){return t.editor.tab(),t.editor.setFocus()}),this.unIndentBtn.tooltip({placement:"right",title:"Unindent (Shift + Tab)",delay:e}),this.unIndentBtn.on("click",function(){return t.editor.shiftTab(),t.editor.setFocus()}),this.toggleBtn.tooltip({placement:"right",title:"Toggle line type (Alt + A)",delay:e}),this.toggleBtn.on("click",function(){return t.editor.toggleType(),t.editor.setFocus()}),this.boldBtn.tooltip({placement:"right",title:"Bold (Ctrl + B)",delay:e}),this.boldBtn.on("click",function(){return t.editor.strong(),t.editor.setFocus()}),this.linkBtn.tooltip({placement:"right",title:"Create or edit a link (Ctrl + K)",delay:e}),this.linkBtn.on("click",function(e){return t.editor.linkifySelection()}),this.metaBtn.tooltip({placement:"right",title:"Add a meta-object (@)",delay:e}),this.metaBtn.on("click",function(e){return t.editor.emulateAt(),t.editor.setFocus()}),this.saveEditorBtn.tooltip({placement:"right",title:"Save the current content",delay:e})},n.prototype.setModel=function(e,t){return this.model=e,this.setTitle(e.title),this.setContent(e),this.createBreadcrumb(e,t),this.fileList.configure(this.model),this.fileList.render()},n.prototype.updateEditorReminderCf=function(e){return this.editor.setReminderCf("note "+e,{app:"notes",url:"note/"+this.model.id+"/"})},n.prototype.showLoading=function(){return this.noteFullTitle.hide(),this.$("#editor-container").hide(),this.$("#note-style").spin("large")},n.prototype.hideLoading=function(){return this.noteFullTitle.show(),this.$("#editor-container").show(),this.$("#note-style").spin()},n.prototype.setTitle=function(e){return this.noteFullTitle.val(e),this.updateEditorReminderCf(e)},n.prototype.saveEditorContent=function(e){var t,n=this;if(this.model!=null&&this.editor!=null&&this.savingState!=="clean")return this.savingState="saving",clearTimeout(this.saveTimer),this.saveTimer=null,this.saveButton.spin("small"),this.editor.saveTasks(),t={content:this.editor.getEditorContent()},s.updateNote(this.model.id,t,function(t){t?(alert("Unable to save changes on the server. Try again"),console.log(t)):n.savingState==="saving"&&(n.savingState="clean"),n.homeView.latestView.refresh(),n.saveButton.addClass("active"),n.saveButton.spin();if(typeof e=="function")return e(t)})},n.prototype.setContent=function(e){return e.content?e.version?this.editor.setEditorContent(e.content):this.editor.setEditorContentFromMD(e.content):this.editor.deleteContent()},n.prototype.createBreadcrumb=function(e,t){var n,r,i,s,o,u;u=e.path,i=u.pop(),n="",s=this.homeView.tree.jstreeEl.jstree("get_selected");while(u.length>0)s=t.inst._get_parent(s),o="#note/"+s[0].id+"/",r=u.join("/"),i=u.pop(),n="<a href='"+o+r+"'> "+i+"</a> >"+n;return n="<a href='#note/all'> All</a> > "+n,this.breadcrumb.find("a").unbind(),this.breadcrumb.html(n),this.breadcrumb.find("a").click(function(e){var t,n;return e.preventDefault(),t=e.target.hash.substring(1),o=t.split("/"),n=o[1],app.router.navigate("note/"+n),app.homeView.selectNote(n)})},n.prototype.updateBreadcrumbOnTitleChange=function(e){return this.breadcrumb.find(" a:last").text(e)},n}(Backbone.View)}),require.register("views/search_view",function(e,t,n){var r,i={}.hasOwnProperty,s=function(e,t){function r(){this.constructor=e}for(var n in t)i.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r=function(e){function n(e){this.$el=e,this.$el.hide(),this.$el.html(t("views/templates/search_view")),this.results=this.$(".results"),this.queryTitle=this.$("span")}return s(n,e),n.prototype.id="note-search",n.prototype.fill=function(e,n){var r,i,s,o,u,a;this.results.html(null),this.queryTitle.html(" "+n),s=t("views/templates/search_result");if(e.length){a=[];for(o=0,u=e.length;o<u;o++)i=e[o],r=Date.create(i.lastModificationValueOf),r=r.format(),a.push(this.results.append(s({note:i,date:r})));return a}return this.results.append('<p class="pl1">No note found.</p>')},n.prototype.fadeIn=function(e){return this.$el.fadeIn(e)},n.prototype.fadeOut=function(e){return this.$el.fadeOut(e)},n.prototype.hide=function(){return this.$el.hide()},n}(Backbone.View),n.exports=r}),require.register("views/templates/content-empty",function(exports,require,module){module.exports=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){var interp;buf.push('<div id="CNID_1" class="Tu-1"><span></span><br/></div>')}return buf.join("")}}),require.register("views/templates/editor",function(exports,require,module){module.exports=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){var interp;buf.push('<div id="editor-button-bar" class="btn-group btn-group-vertical clearfix"><button id="indentBtn" class="btn btn-small"><i class="icon-indent-right"></i></button><button id="unIndentBtn" class="btn btn-small"><i class="icon-indent-left"></i></button><button id="toggleBtn" class="btn btn-small"><i class="icon-toggle"></i></button><button id="boldBtn" class="btn btn-small"><i class="icon-bold"></i></button><button id="linkBtn" class="btn btn-small"><i class="icon-link"></i></button><button id="metaBtn" class="btn btn-small"><i class="icon-tags"></i></button><button id="save-editor-content" class="btn active btn-small"><i class="icon-download-alt"></i></button></div><div class="spacer"></div><div id="note-file-list"><div id="file-number">0 files</div><div id="file-pic"></div><div id="file-list"></div></div><div id="editor-container"></div>')}return buf.join("")}}),require.register("views/templates/home",function(exports,require,module){module.exports=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){var interp;buf.push('<div id="nav" class="ui-layout-west"><div id="tree"></div></div><div id="note-area" class="ui-layout-center"><div id="search-view"></div><div id="latest-view"></div><div id="note-full" class="note-full"><div id="note-full-breadcrumb">/</div><div id="note-style"><input id="note-full-title"/><div id="editor"></div></div><div class="clearfix"></div></div></div><div id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" class="modal hide fade in"><div class="modal-header"><h3 id="myModalLabel">Warning!</h3></div><div class="modal-body"><p>You are about to delete this note and all its children. Do you want to continue?</p></div><div class="modal-footer"><button id="modal-yes" data-dismiss="modal" aria-hidden="true" class="btn">Yes</button><button data-dismiss="modal" aria-hidden="true" class="btn">No</button></div></div>')}return buf.join("")}}),require.register("views/templates/note",function(exports,require,module){module.exports=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){var interp;buf.push("<p>"+escape((interp=note.humanPath.split(",").join(" / "))==null?"":interp)+"</p><h2>"+escape((interp=note.title)==null?"":interp)+'</h2><textarea id="note-content"></textarea>')}return buf.join("")}}),require.register("views/templates/search_result",function(exports,require,module){module.exports=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){var interp;buf.push('<div class="search-result"><h2><span class="date">'+escape((interp=date)==null?"":interp)+"</span><a"),buf.push(attrs({href:"#note/"+note.id+"/"+note.slugPath+""},{href:!0})),buf.push("> "+escape((interp=note.title)==null?"":interp)+"</a></h2><p><"+note.preview+"></"+note.preview+"></p></div>")}return buf.join("")}}),require.register("views/templates/search_view",function(exports,require,module){module.exports=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){var interp;buf.push('<h1>Search results for<span></span></h1><div class="results"></div>')}return buf.join("")}}),require.register("views/templates/tree_buttons",function(exports,require,module){module.exports=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){var interp;buf.push('<div id="tree-buttons"><div id="tree-create" class="button"><i class="icon-plus"></i></div><div id="tree-rename" class="button"><i class="icon-pencil"></i></div><div id="tree-remove" class="button"><i class="icon-remove"></i></div></div><div id="tree-top-buttons"><input id="tree-search-field" type="text" class="span2"/><i id="suppr-button" style="display: none" class="icon-remove-circle"></i></div><div id="my-notes"><a href="#note/all"><img id="my-notes-pic" src="img/my-notes.png"/></a><div id="create-note"></div></div>')}return buf.join("")}}),require.register("views/widgets/file_list",function(e,t,n){var r,i=function(e,t){return function(){return e.apply(t,arguments)}},s={}.hasOwnProperty,o=function(e,t){function r(){this.constructor=e}for(var n in t)s.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r=t("../../helpers"),e.FileList=function(e){function t(e,t){this.model=e,this.id=t,this.onMouseLeave=i(this.onMouseLeave,this),this.onMouseEnter=i(this.onMouseEnter,this),this.onUploadComplete=i(this.onUploadComplete,this),this.onSubmit=i(this.onSubmit,this),this.$el=$(this.id),this.uploadButton=$("#file-pic"),this.uploader=new qq.FileUploaderBasic({button:document.getElementById("file-pic"),multiple:!1,forceMultipart:!0,onComplete:this.onUploadComplete,onSubmit:this.onSubmit}),this.widget=$("#note-file-list"),this.widget.mouseenter(this.onMouseEnter),this.widget.mouseleave(this.onMouseLeave)}return o(t,e),t.prototype.onSubmit=function(e,t){return this.model._attachments!=null&&this.model._attachments[t]!=null?!1:this.uploadButton.spin("small")},t.prototype.onUploadComplete=function(e,t,n){var r=this;return this.model._attachments==null&&(this.model._attachments={}),this.model._attachments[t]={},this.addFileLine(t),this.setFileNumber(),this.$el.slideDown(function(){return r.uploadButton.spin()})},t.prototype.onMouseEnter=function(){var e=this;return this.widget.unbind("mouseleave"),this.$el.slideDown(function(){return e.widget.mouseleave(e.onMouseLeave)})},t.prototype.onMouseLeave=function(){return this.$el.slideUp()},t.prototype.configure=function(e){return this.model=e,this.uploader._options.action="notes/"+this.model.id+"/files/",this.uploader._handler._options.action="notes/"+this.model.id+"/files/",this.setFileNumber()},t.prototype.render=function(){var e;if(this.model!=null){this.$(".note-file button").unbind(),this.$el.html(null);for(e in this.model._attachments)this.addFileLine(e);return this.setFileNumber()}},t.prototype.addFileLine=function(e){var t,n,i,s,o,u=this;return s="notes/"+this.model.id+"/files/"+e,o=r.slugify(e),i="note-"+o,this.$el.append('<div class="note-file spacer" id="'+i+'">\n    <a href="'+s+'" target="_blank">'+e+"</a>\n    <button>(x)</button>\n</div>"),n=this.$el.find("#"+i),n.hide(),t=n.find("button"),t.click(function(r){return t.html("&nbsp;&nbsp;&nbsp;"),t.spin("tiny"),$.ajax({url:s,type:"DELETE",success:function(){return t.spin(),delete u.model._attachments[e],u.setFileNumber(),n.fadeOut(function(){return n.remove()})},error:function(){return alert("Server error occured.")}})}),n.fadeIn()},t.prototype.setFileNumber=function(){var e,t;t=0;for(e in this.model._attachments)t++;return t>1?this.widget.find("#file-number").html(""+t+" files"):t===1?this.widget.find("#file-number").html(""+t+" file"):this.widget.find("#file-number").html("no file")},t}(Backbone.View)}),require.register("views/widgets/tree",function(e,t,n){var r,i=function(e,t){return function(){return e.apply(t,arguments)}},s=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};r=t("lib/slug"),e.Tree=function(){function n(n,r,s){this._getSlugPath=i(this._getSlugPath,this),this._updateSuggestionList=i(this._updateSuggestionList,this),this._recursiveRemoveSuggestionList=i(this._recursiveRemoveSuggestionList,this);var o,u;o=$("#tree"),this.jstreeEl=o,this.searchField=$("#tree-search-field"),n.prepend(t("../templates/tree_buttons")),r=JSON.parse(r),this.widget=this.jstreeEl.jstree({plugins:["themes","json_data","ui","crrm","unique","sort","cookies","types","hotkeys","dnd","search"],json_data:{data:r},types:{"default":{valid_children:"default",icon:{image:"test.png"}},folder:{icon:{image:"test.png"}},root:{valid_children:null,delete_node:!1,rename_node:!1,move_node:!1,start_drag:!1}},crrm:{move:{check_move:function(e){return e.r.attr("id")==="tree-node-all"?!1:!0}}},cookies:{save_selected:!1},ui:{select_limit:1},hotkeys:{del:!1},themes:{theme:"default",dots:!1,icons:!1},core:{animation:0,initially_open:["tree-node-all"]},search:{search_method:"jstree_contains_multi",show_only_matches:!0}}),this.setListeners(s),this.setSearchField(),u=function(t){var n,r,i,s,o,a;o=t.children,a=[];for(i=0,s=o.length;i<s;i++)n=o[i],r={type:"folder",name:n.data},e.push(r),a.push(u(n));return a},u(r),e.sort(this._sortFunction)}var e;return e=[],n.prototype.setListeners=function(e){var t,n,r,i,s,o,u=this;return t=this.jstreeEl,i=$("#tree-buttons"),n=$("#myModal"),r=$("#modal-yes"),s=$("#tree-buttons-root"),$("#tree-create").tooltip({placement:"bottom",title:"Add a note"}),$("#tree-create").on("click",function(e){var n;return n=this.parentElement.parentElement,t.jstree("create",n,0,"New note"),$(this).tooltip("hide"),e.stopPropagation(),e.preventDefault()}),$("#tree-create-root").tooltip({placement:"bottom",title:"Add a note"}),$("#tree-create-root").on("click",function(e){var n;return n=this.parentElement.parentElement,t.jstree("create",n,0,"New note"),$(this).tooltip("hide"),e.stopPropagation(),e.preventDefault()}),$("#tree-rename").tooltip({placement:"bottom",title:"Rename a note"}),$("#tree-rename").on("click",function(e){return t.jstree("rename",this.parentElement.parentElement),$(this).tooltip("hide"),e.preventDefault(),e.stopPropagation()}),$("#tree-remove").tooltip({placement:"bottom",title:"Remove a note"}),$("#tree-remove").on("click",function(i){var s;return s=i.target.parentElement.parentElement.parentElement.parentElement,$(i.target.parentElement).tooltip("hide"),n.modal("show"),r.unbind("click"),r.on("click",function(){u._recursiveRemoveSuggestionList(s);if(s.id!=="tree-node-all")return t.jstree("remove",s),e.onRemove(s.id)}),i.preventDefault(),i.stopPropagation()}),o=$("#nav"),this.widget.on("hover_node.jstree",function(e,t){return t.rslt.obj[0].id==="tree-node-all"?(s.appendTo(t.args[0]),s.css("display","block")):(i.appendTo(t.args[0]),i.css("display","block"))}),this.widget.on("dehover_node.jstree",function(e,t){return t.rslt.obj[0].id==="tree-node-all"?(s.css("display","none"),s.appendTo(o)):(i.css("display","none"),i.appendTo(o))}),this.widget.on("create.jstree",function(t,n){var r,i;return r=n.inst.get_text(n.rslt.obj),i=n.rslt.parent[0].id,u._updateSuggestionList("create",r,null),e.onCreate(i,n.rslt.name,n)}),this.widget.on("rename.jstree",function(t,n){var r,i;r=n.rslt.new_name,i=n.rslt.old_name,u._updateSuggestionList("rename",r,i);if(i!==r)return e.onRename(n.rslt.obj[0].id,r)}),this.widget.on("select_node.jstree",function(t,n){var r,i,s,o;return i=n.rslt.obj[0].id,i==="tree-node-all"?o="/all":(r=n.inst.get_text(n.rslt.obj),s=n.inst._get_parent(),o="/"+n.rslt.obj[0].id+u._getSlugPath(s,r)),u.currentPath=o,u.currentData=n,u.currentNote_uuid=i,u.jstreeEl[0].focus(),e.onSelect(o,i,n)}),this.widget.on("move_node.jstree",function(t,n){var r,i;return r=n.rslt.o[0].id,i=n.rslt.o[0].parentElement.parentElement.id,e.onDrop(r,i)}),this.widget.on("loaded.jstree",function(t,n){return e.onLoaded()}),this.onSearch=e.onSearch},n.prototype.setSearchField=function(){var t,n,r,i,o,u,a=this;return this.searchField=$("#tree-search-field"),n=this.searchField,t=this.jstreeEl,this.searchField.blur(function(){return t.css("margin-top",10)}),o=function(e,t){var n,r,i,o,u,a,f,l,c,h,p,d;o=[],i=[],c="";for(p=0,d=e.length;p<d;p++)f=e[p],r=new RegExp("^"+t,"i"),a=r.test(f),n=new RegExp("("+t+")","gi"),u=n.test(f),a?(l=f.replace(n,function(e,t){return"<span class='bold-name'>"+e+"</span>"}),o.push(l)):u&&(l=f.replace(n,function(e,t){return"<span class='bold-name'>"+e+"</span>"}),!(s.call(o,l)>=0)&&!(s.call(i,l)>=0)&&i.push(l));return h=o.concat(i),h},u=function(e,t){var r;if(e==='"'+n.val()+'"')return"<i class='icon-search icon-suggestion'></i>";r=0,e=e.replace(/<.*?>/g,"");while(r<t.length&&e!==t[r].name)r++;if(r<t.length&&t[r].type==="folder")return"<i class='icon-folder-open icon-suggestion'></i>"},r=function(e){var t,n,r,i;i=$(".text-tag .text-label");for(n=0,r=i.length;n<r;n++)t=i[n],e+=" "+t.innerHTML;return a.onSearch(e)},i=n.textext({plugins:"tags prompt focus autocomplete",prompt:"Search...",autocomplete:{dropdownMaxHeight:"200px",render:function(t){return u(t,e)+t}},ext:{core:{onGetFormData:function(e,t,n){var i;i=this.input().val(),t[0]={input:i,form:i};if(i==="")return r("")}},autocomplete:{onClick:function(e){var t,n;t=this,n=$(e.target),(n.is(".text-suggestion")||n.is(".text-label")||n.is(".icon-suggestion")||n.is(".bold-name"))&&t.trigger("enterKeyPress");if(t.core().hasPlugin("tags"))return t.val("")}},itemManager:{nameField:function(e){var t,n,r,i;n=[];for(r=0,i=e.length;r<i;r++)t=e[r],n.push(t.name);return n},itemToString:function(e){return/".*"/.test(e)?e=e.replace(/"(.*)"/,function(e,t){return t}):e=e.replace(/<.*?>/g,"")}},tags:{renderTag:function(e){var t;return t=$(this.opts("html.tag")),t.find(".text-label").text(this.itemManager().itemToString(e)),t.data("text-tag",e),t}}}}),i.bind("getSuggestions",function(t,r){var i,s,u,a;return u=$(t.target).textext()[0],s=(r?r.query:"")||"",i=u.itemManager().nameField(e),i=o(i,s),i=['"'+n.val()+'"'].concat(i),a=i.length*12,$(this).trigger("setSuggestions",{result:i})}),i.bind("isTagAllowed",function(e,n){return t.css("margin-top",10),r(n.tag)})},n.prototype.addSearchTag=function(e){return this.searchField.textext()[0].tags().addTags([e])},n.prototype.selectNode=function(e){var t,n;t=$("#"+e);if(t[0])return n=this.jstreeEl.jstree("deselect_all",null),n=this.jstreeEl.jstree("select_node",t);if(!this.widget.jstree("get_selected")[0])return n=this.jstreeEl.jstree("select_node","#tree-node-all")},n.prototype.disable_hotkeys=function(){return this.jstreeEl.jstree("disable_hotkeys")},n.prototype.enable_hotkeys=function(){return this.jstreeEl.jstree("enable_hotkeys")},n.prototype._sortFunction=function(e,t){if(e.name>t.name)return 1;if(e.name===t.name)return 0;if(e.name<t.name)return-1},n.prototype._recursiveRemoveSuggestionList=function(e){var t,n,r,i;if(e.children[2]===void 0)console.log(e.children);else{i=e.children[2].children;for(n=0,r=i.length;n<r;n++)t=i[n],this._recursiveRemoveSuggestionList(t)}return this._updateSuggestionList("remove",e.children[1].text.replace(/\s/,""),null)},n.prototype._updateSuggestionList=function(t,n,r){var i,s;if(t==="create")return s={type:"folder",name:n},e.push(s),e.sort(this._sortFunction);if(t==="rename"){i=0;while(i<e.length&&e[i].name!==n)i++;if(e.length>i)return e[i].name=n,e.sort(this._sortFunction)}else if(t==="remove"){i=0;while(i<e.length&&e[i].name!==n)i++;if(e.length>i)return e.splice(i,1)}},n.prototype._getPath=function(e,t){var n,i;t!=null&&(i=[r(t)]),n="all";while(n&&e!==void 0&&e.children!==void 0)n=e.children("a:eq(0)").text(),i.unshift(r(n)),e=e.parent().parent();return i},n.prototype._getSlugPath=function(e,t){return this._getPath(e,t).join("/")},n}()})